<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>All Inquiries - Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: "#015486",
                        secondary: "#EF3451",
                    },
                },
            },
        };
    </script>
</head>

<body class="bg-gray-100 min-h-screen flex flex-col">

    <!-- Inquiry Detail Modal -->
    <div id="inquiryModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white w-full max-w-2xl rounded-lg shadow-lg p-6 relative">
            <button onclick="closeInquiryModal()"
                class="absolute top-4 right-4 text-gray-400 hover:text-gray-700">✕</button>
            <h3 class="text-lg font-semibold mb-4">Inquiry Details</h3>
            <div id="inquiryModalContent" class="grid grid-cols-2 gap-4 text-sm"></div>
        </div>
    </div>

    <!-- HEADER -->
    <header class="bg-white shadow">
        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <img src="{{ url_for('static', filename='images/logo-fit.png') }}" alt="Company Logo"
                    class="h-10 w-auto" />
                <span class="text-xl font-semibold text-gray-800">Admin Dashboard</span>
            </div>
            <a href="{{ url_for('admin_logout') }}" class="text-sm text-red-600 hover:underline">Logout</a>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="flex-1">
        <div class="max-w-7xl mx-auto px-6 py-8 space-y-8">

            <!-- KPI CARDS -->
            <section class="grid grid-cols-1 md:grid-cols-3 gap-6">

                <!-- Total Inquiries -->
                <div class="bg-white rounded-lg shadow-lg overflow-hidden transform transition hover:scale-105">
                    <div class="bg-gradient-to-r from-primary to-primary/80 h-1 w-full"></div>
                    <div class="p-6 flex items-center gap-4">
                        <div class="p-3 bg-primary/10 rounded-full">
                            <!-- User Group Icon -->
                            <svg class="h-6 w-6 text-primary" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"
                                stroke-linecap="round" stroke-linejoin="round">
                                <path d="M17 21v-2a4 4 0 00-3-3.87M7 21v-2a4 4 0 013-3.87M12 7a4 4 0 100-8 4 4 0 000 8z"></path>
                            </svg>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-500">Total Inquiries</p>
                            <p class="text-3xl font-bold text-primary">{{ total_inquiries }}</p>
                        </div>
                    </div>
                </div>

                <!-- Pending Inquiries -->
                <div class="bg-white rounded-lg shadow-lg overflow-hidden transform transition hover:scale-105">
                    <div class="bg-gradient-to-r from-secondary to-secondary/80 h-1 w-full"></div>
                    <div class="p-6 flex items-center gap-4">
                        <div class="p-3 bg-secondary/10 rounded-full">
                            <!-- Clock Icon -->
                            <svg class="h-6 w-6 text-secondary" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"
                                stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M12 6v6l4 2"></path>
                            </svg>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-500">Pending Inquiries</p>
                            <p class="text-3xl font-bold text-secondary">{{ pending_inquiries }}</p>
                        </div>
                    </div>
                </div>

                <!-- Contacted Inquiries -->
                <div class="bg-white rounded-lg shadow-lg overflow-hidden transform transition hover:scale-105">
                    <div class="bg-gradient-to-r from-primary to-primary/80 h-1 w-full"></div>
                    <div class="p-6 flex items-center gap-4">
                        <div class="p-3 bg-primary/10 rounded-full">
                            <!-- Check Icon -->
                            <svg class="h-6 w-6 text-primary" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"
                                stroke-linecap="round" stroke-linejoin="round">
                                <path d="M5 13l4 4L19 7"></path>
                            </svg>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-500">Contacted Inquiries</p>
                            <p class="text-3xl font-bold text-primary">{{ contacted_inquiries }}</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- All Inquiries Card -->
            <section class="bg-white rounded shadow">
                <!-- Card Header & Filters -->
                <div class="p-6 border-b space-y-4">
                    <div class="flex justify-between items-center">
                        <h2 class="text-lg font-semibold">All Inquiries</h2>
                        <div>
                            <a href="{{ url_for('admin_dashboard') }}" class="text-sm text-primary hover:underline">
                                Back
                            </a>
                        </div>
                    </div>

                    <!-- Filters & sorting -->
                    <div class="flex flex-col md:flex-row gap-3 md:items-center md:justify-between text-xs">
                        <!-- Keyword -->
                        <div class="flex items-center gap-2 w-full md:w-1/2">
                            <label for="inquiryKeyword" class="text-gray-500 whitespace-nowrap">Name / Email /
                                Company:</label>
                            <input id="inquiryKeyword" type="text" placeholder="Filter by name, email, or company"
                                class="w-full border border-gray-200 rounded-md px-2 py-1 text-xs focus:outline-none focus:ring-1 focus:ring-primary" />
                        </div>

                        <div class="flex flex-wrap gap-3 w-full md:w-1/2 justify-end">
                            <!-- Status filter dropdown -->
                            <div class="flex items-center gap-2">
                                <span class="text-gray-500">Status:</span>
                                <div class="filter-dropdown relative inline-block text-left"
                                    data-select="inquiryStatusFilter" data-filter-type="inquiries">
                                    <button type="button"
                                        class="status-select bg-gray-100 text-gray-700 inline-flex justify-start items-center gap-1 rounded-full px-3 py-1 text-xs font-semibold"
                                        onclick="toggleFilterDropdown(this)">
                                        <span class="filter-dropdown-label">All</span>
                                        <svg class="-mr-1 ml-1 h-3 w-3" xmlns="http://www.w3.org/2000/svg" fill="none"
                                            viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M19 9l-7 7-7-7" />
                                        </svg>
                                    </button>
                                    <div
                                        class="filter-dropdown-menu hidden absolute right-0 mt-1 w-40 rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 z-20">
                                    </div>
                                </div>
                                <select id="inquiryStatusFilter" class="hidden">
                                    <option value="all">All</option>
                                    <option value="Pending">Pending</option>
                                    <option value="Contacted">Contacted</option>
                                </select>
                            </div>

                            <!-- Industry filter dropdown -->
                            <div class="flex items-center gap-2">
                                <span class="text-gray-500">Industry:</span>
                                <div class="filter-dropdown relative inline-block text-left"
                                    data-select="inquiryIndustryFilter" data-filter-type="inquiries">
                                    <button type="button"
                                        class="status-select bg-gray-100 text-gray-700 inline-flex justify-start items-center gap-1 rounded-full px-3 py-1 text-xs font-semibold"
                                        onclick="toggleFilterDropdown(this)">
                                        <span class="filter-dropdown-label">All</span>
                                        <svg class="-mr-1 ml-1 h-3 w-3" xmlns="http://www.w3.org/2000/svg" fill="none"
                                            viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M19 9l-7 7-7-7" />
                                        </svg>
                                    </button>
                                    <div
                                        class="filter-dropdown-menu hidden absolute right-0 mt-1 w-40 rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 z-20">
                                    </div>
                                </div>
                                <select id="inquiryIndustryFilter" class="hidden">
                                    <option value="all">All</option>
                                </select>
                            </div>

                            <!-- Sort dropdown -->
                            <div class="flex items-center gap-2">
                                <span class="text-gray-500">Sort by:</span>
                                <div class="filter-dropdown relative inline-block text-left" data-select="inquirySort"
                                    data-filter-type="inquiries">
                                    <button type="button"
                                        class="status-select bg-gray-100 text-gray-700 inline-flex justify-start items-center gap-1 rounded-full px-3 py-1 text-xs font-semibold"
                                        onclick="toggleFilterDropdown(this)">
                                        <span class="filter-dropdown-label">Newest</span>
                                        <svg class="-mr-1 ml-1 h-3 w-3" xmlns="http://www.w3.org/2000/svg" fill="none"
                                            viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M19 9l-7 7-7-7" />
                                        </svg>
                                    </button>
                                    <div
                                        class="filter-dropdown-menu hidden absolute right-0 mt-1 w-40 rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 z-20">
                                    </div>
                                </div>
                                <select id="inquirySort" class="hidden">
                                    <option value="newest">Newest</option>
                                    <option value="oldest">Oldest</option>
                                    <option value="name-asc">Name A–Z</option>
                                    <option value="name-desc">Name Z–A</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Table -->
                <div class="overflow-x-auto">
                    <table class="min-w-full w-full text-sm">
                        <thead class="bg-gray-50 text-gray-600">
                            <tr>
                                <th class="px-4 py-3 text-left">Name</th>
                                <th class="px-4 py-3 text-left">Email</th>
                                <th class="px-4 py-3 text-left">Company</th>
                                <th class="px-4 py-3 text-left">Industry</th>
                                <th class="px-4 py-3 text-left">Status</th>
                                <th class="px-4 py-3 text-left">Date</th>
                            </tr>
                        </thead>
                        <tbody id="inquiriesContainer">
                            {% for q in all_inquiries %}
                            <tr class="border-t hover:bg-gray-50 cursor-pointer inquiry-row"
                                data-inquiry='{{ q | tojson | safe }}'>
                                <td class="px-4 py-3 font-medium">{{ q.name }}</td>
                                <td class="px-4 py-3">{{ q.email }}</td>
                                <td class="px-4 py-3">{{ q.company }}</td>
                                <td class="px-4 py-3">{{ q.industry }}</td>

                                <td class="px-4 py-3" onclick="event.stopPropagation()">
                                    <div class="filter-dropdown relative inline-block text-left">
                                        <button type="button" class="status-select inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold
                                    {% if q.status == 'Pending' %} bg-yellow-100 text-yellow-800
                                    {% else %} bg-green-100 text-green-800 {% endif %}"
                                            onclick="toggleFilterDropdown(this)">
                                            <span class="filter-dropdown-label">{{ q.status }}</span>
                                            <svg class="ml-1 h-3 w-3" xmlns="http://www.w3.org/2000/svg" fill="none"
                                                viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M19 9l-7 7-7-7" />
                                            </svg>
                                        </button>

                                        <div
                                            class="filter-dropdown-menu hidden absolute right-0 mt-1 w-32 rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 z-20">
                                            <form method="POST"
                                                action="{{ url_for('update_inquiry_status', inquiry_id=q.id) }}">
                                                <button type="submit" name="status" value="Pending"
                                                    class="block w-full text-left px-3 py-1.5 text-xs hover:bg-gray-100">
                                                    Pending
                                                </button>
                                                <button type="submit" name="status" value="Contacted"
                                                    class="block w-full text-left px-3 py-1.5 text-xs hover:bg-gray-100">
                                                    Contacted
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-4 py-3 text-gray-500">{{ q.created_at }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>

                </div>

            </section>
        </div>
    </main>

    <script>
        // Country code to full name mapping
        const countryNames = {
            'AF': 'Afghanistan',
            'AL': 'Albania',
            'DZ': 'Algeria',
            'AD': 'Andorra',
            'AO': 'Angola',
            'AG': 'Antigua and Barbuda',
            'AR': 'Argentina',
            'AM': 'Armenia',
            'AU': 'Australia',
            'AT': 'Austria',
            'AZ': 'Azerbaijan',
            'BS': 'Bahamas',
            'BH': 'Bahrain',
            'BD': 'Bangladesh',
            'BB': 'Barbados',
            'BY': 'Belarus',
            'BE': 'Belgium',
            'BZ': 'Belize',
            'BJ': 'Benin',
            'BT': 'Bhutan',
            'BO': 'Bolivia',
            'BA': 'Bosnia and Herzegovina',
            'BW': 'Botswana',
            'BR': 'Brazil',
            'BN': 'Brunei',
            'BG': 'Bulgaria',
            'BF': 'Burkina Faso',
            'BI': 'Burundi',
            'CV': 'Cabo Verde',
            'KH': 'Cambodia',
            'CM': 'Cameroon',
            'CA': 'Canada',
            'CF': 'Central African Republic',
            'TD': 'Chad',
            'CL': 'Chile',
            'CN': 'China',
            'CO': 'Colombia',
            'KM': 'Comoros',
            'CG': 'Congo',
            'CR': 'Costa Rica',
            'HR': 'Croatia',
            'CU': 'Cuba',
            'CY': 'Cyprus',
            'CZ': 'Czech Republic',
            'DK': 'Denmark',
            'DJ': 'Djibouti',
            'DM': 'Dominica',
            'DO': 'Dominican Republic',
            'EC': 'Ecuador',
            'EG': 'Egypt',
            'SV': 'El Salvador',
            'GQ': 'Equatorial Guinea',
            'ER': 'Eritrea',
            'EE': 'Estonia',
            'SZ': 'Eswatini',
            'ET': 'Ethiopia',
            'FJ': 'Fiji',
            'FI': 'Finland',
            'FR': 'France',
            'GA': 'Gabon',
            'GM': 'Gambia',
            'GE': 'Georgia',
            'DE': 'Germany',
            'GH': 'Ghana',
            'GR': 'Greece',
            'GD': 'Grenada',
            'GT': 'Guatemala',
            'GN': 'Guinea',
            'GW': 'Guinea-Bissau',
            'GY': 'Guyana',
            'HT': 'Haiti',
            'HN': 'Honduras',
            'HU': 'Hungary',
            'IS': 'Iceland',
            'IN': 'India',
            'ID': 'Indonesia',
            'IR': 'Iran',
            'IQ': 'Iraq',
            'IE': 'Ireland',
            'IL': 'Israel',
            'IT': 'Italy',
            'JM': 'Jamaica',
            'JP': 'Japan',
            'JO': 'Jordan',
            'KZ': 'Kazakhstan',
            'KE': 'Kenya',
            'KI': 'Kiribati',
            'KW': 'Kuwait',
            'KG': 'Kyrgyzstan',
            'LA': 'Laos',
            'LV': 'Latvia',
            'LB': 'Lebanon',
            'LS': 'Lesotho',
            'LR': 'Liberia',
            'LY': 'Libya',
            'LI': 'Liechtenstein',
            'LT': 'Lithuania',
            'LU': 'Luxembourg',
            'MG': 'Madagascar',
            'MW': 'Malawi',
            'MY': 'Malaysia',
            'MV': 'Maldives',
            'ML': 'Mali',
            'MT': 'Malta',
            'MH': 'Marshall Islands',
            'MR': 'Mauritania',
            'MU': 'Mauritius',
            'MX': 'Mexico',
            'FM': 'Micronesia',
            'MD': 'Moldova',
            'MC': 'Monaco',
            'MN': 'Mongolia',
            'ME': 'Montenegro',
            'MA': 'Morocco',
            'MZ': 'Mozambique',
            'MM': 'Myanmar',
            'NA': 'Namibia',
            'NR': 'Nauru',
            'NP': 'Nepal',
            'NL': 'Netherlands',
            'NZ': 'New Zealand',
            'NI': 'Nicaragua',
            'NE': 'Niger',
            'NG': 'Nigeria',
            'MK': 'North Macedonia',
            'NO': 'Norway',
            'OM': 'Oman',
            'PK': 'Pakistan',
            'PW': 'Palau',
            'PA': 'Panama',
            'PG': 'Papua New Guinea',
            'PY': 'Paraguay',
            'PE': 'Peru',
            'PH': 'Philippines',
            'PL': 'Poland',
            'PT': 'Portugal',
            'QA': 'Qatar',
            'RO': 'Romania',
            'RU': 'Russia',
            'RW': 'Rwanda',
            'WS': 'Samoa',
            'SM': 'San Marino',
            'ST': 'Sao Tome and Principe',
            'SA': 'Saudi Arabia',
            'SN': 'Senegal',
            'RS': 'Serbia',
            'SC': 'Seychelles',
            'SL': 'Sierra Leone',
            'SG': 'Singapore',
            'SK': 'Slovakia',
            'SI': 'Slovenia',
            'SB': 'Solomon Islands',
            'SO': 'Somalia',
            'ZA': 'South Africa',
            'KR': 'South Korea',
            'SS': 'South Sudan',
            'ES': 'Spain',
            'LK': 'Sri Lanka',
            'SD': 'Sudan',
            'SR': 'Suriname',
            'SE': 'Sweden',
            'CH': 'Switzerland',
            'SY': 'Syria',
            'TW': 'Taiwan',
            'TJ': 'Tajikistan',
            'TZ': 'Tanzania',
            'TH': 'Thailand',
            'TL': 'Timor-Leste',
            'TG': 'Togo',
            'TO': 'Tonga',
            'TT': 'Trinidad and Tobago',
            'TN': 'Tunisia',
            'TR': 'Turkey',
            'TM': 'Turkmenistan',
            'TV': 'Tuvalu',
            'UG': 'Uganda',
            'UA': 'Ukraine',
            'AE': 'United Arab Emirates',
            'GB': 'United Kingdom',
            'US': 'United States',
            'UY': 'Uruguay',
            'UZ': 'Uzbekistan',
            'VU': 'Vanuatu',
            'VE': 'Venezuela',
            'VN': 'Vietnam',
            'YE': 'Yemen',
            'ZM': 'Zambia',
            'ZW': 'Zimbabwe'
        };

        // Helper function to convert country code to full name
        function getCountryName(countryCode) {
            if (!countryCode) return countryCode;
            return countryNames[countryCode.toUpperCase()] || countryCode;
        }

        function openInquiryModal(data) {
            const modal = document.getElementById("inquiryModal");
            const content = document.getElementById("inquiryModalContent");

            content.innerHTML = `
      <div><strong>Name:</strong> ${data.name}</div>
      <div><strong>Email:</strong> ${data.email}</div>
      <div><strong>Phone:</strong> ${data.phone}</div>
      <div><strong>Company:</strong> ${data.company}</div>
      <div><strong>Job Title:</strong> ${data.job_title}</div>
      <div><strong>Industry:</strong> ${data.industry}</div>
      <div><strong>Country:</strong> ${getCountryName(data.country)}</div>
      <div><strong>Requirement Type:</strong> ${data.requirement_type}</div>
      <div><strong>Summary:</strong> ${data.requirement_summary}</div>
      <div><strong>Details:</strong><br>${data.detailed_requirements}</div>
      <div><strong>Timeline:</strong> ${data.timeline}</div>
      <div><strong>Budget:</strong> ${data.budget_range}</div>
      <div><strong>Status:</strong> ${data.status}</div>
      <div class="text-xs text-gray-500 mt-2">Submitted on ${data.created_at}</div>
      `;

            modal.classList.remove("hidden");
            modal.classList.add("flex");
        }

        function closeInquiryModal() {
            const modal = document.getElementById("inquiryModal");
            modal.classList.add("hidden");
            modal.classList.remove("flex");
        }

        document.querySelectorAll(".inquiry-row").forEach(row => {
            row.addEventListener("click", () => {
                const data = JSON.parse(row.dataset.inquiry);
                openInquiryModal(data);
            });
        });

        function parseDateSafe(dateStr) {
            const d = new Date(dateStr);
            return isNaN(d.getTime()) ? 0 : d.getTime();
        }

        function filterAndSortInquiries() {
            const tbody = document.getElementById("inquiriesContainer");
            if (!tbody) return;

            const keyword = (document.getElementById("inquiryKeyword")?.value || "").toLowerCase();
            const statusFilter = document.getElementById("inquiryStatusFilter")?.value || "all";
            const industryFilter = document.getElementById("inquiryIndustryFilter")?.value || "all";
            const sort = document.getElementById("inquirySort")?.value || "newest";

            const rows = Array.from(tbody.querySelectorAll("tr"));
            const visibleRows = [];
            const hiddenRows = [];

            rows.forEach(row => {
                let data = {};
                try {
                    data = JSON.parse(row.dataset.inquiry || "{}");
                } catch (_) {
                    data = {};
                }

                const name = (data.name || "").toLowerCase();
                const email = (data.email || "").toLowerCase();
                const company = (data.company || "").toLowerCase();
                const industry = (data.industry || "").toLowerCase();

                const matchesKeyword = !keyword || [name, email, company].some(field => field.includes(keyword));

                const rowStatus = data.status || "";
                const matchesStatus = statusFilter === "all" || rowStatus === statusFilter;

                const matchesIndustry = industryFilter === "all" || industry === industryFilter.toLowerCase();

                const matches = matchesKeyword && matchesStatus && matchesIndustry;
                row.style.display = matches ? "" : "none";
                (matches ? visibleRows : hiddenRows).push(row);
            });

            const sortedVisible = [...visibleRows].sort((a, b) => {
                const aData = JSON.parse(a.dataset.inquiry || "{}");
                const bData = JSON.parse(b.dataset.inquiry || "{}");

                if (sort === "name-asc" || sort === "name-desc") {
                    const nameA = (aData.name || "").toLowerCase();
                    const nameB = (bData.name || "").toLowerCase();
                    if (nameA < nameB) return sort === "name-asc" ? -1 : 1;
                    if (nameA > nameB) return sort === "name-asc" ? 1 : -1;
                    return 0;
                }

                // default: sort by created_at date
                const dateA = parseDateSafe(aData.created_at || "");
                const dateB = parseDateSafe(bData.created_at || "");
                return sort === "oldest" ? dateA - dateB : dateB - dateA;
            });

            tbody.innerHTML = "";
            sortedVisible.forEach(row => tbody.appendChild(row));
            hiddenRows.forEach(row => tbody.appendChild(row));
        }

        async function populateIndustryFilter() {
            const select = document.getElementById("inquiryIndustryFilter");
            const tbody = document.getElementById("inquiriesContainer");
            if (!select || !tbody) return;

            const currentValue = select.value || "all";
            const existing = new Set();
            Array.from(select.options).forEach(opt => {
                if (opt.value && opt.value !== "all") existing.add(opt.value);
            });

            // First, get industries from current table data (always works)
            const rows = Array.from(tbody.querySelectorAll("tr"));
            rows.forEach(row => {
                let data = {};
                try {
                    data = JSON.parse(row.dataset.inquiry || "{}");
                } catch (_) {
                    data = {};
                }
                const industry = data.industry;
                if (industry && !existing.has(industry)) {
                    const opt = document.createElement("option");
                    opt.value = industry;
                    opt.textContent = industry;
                    select.appendChild(opt);
                    existing.add(industry);
                }
            });

            // Then try to get additional industries from API (if authentication works)
            try {
                const response = await fetch('/api/inquiry-industries');
                
                if (response.ok) {
                    const inquiryData = await response.json();
                    
                    // Add any missing industries from API
                    if (inquiryData.industries) {
                        inquiryData.industries.forEach(industry => {
                            if (industry && !Array.from(select.options).some(opt => opt.value === industry)) {
                                const opt = document.createElement("option");
                                opt.value = industry;
                                opt.textContent = industry;
                                select.appendChild(opt);
                            }
                        });
                    }
                }
            } catch (apiError) {
                // API endpoints not available, using table data only
            }

            // restore previous selection if still present
            if (Array.from(select.options).some(o => o.value === currentValue)) {
                select.value = currentValue;
            } else {
                select.value = "all";
            }
        }

        function toggleFilterDropdown(button) {
            const wrapper = button.closest(".filter-dropdown");
            const menu = wrapper?.querySelector(".filter-dropdown-menu");
            if (!menu) return;

            // Close all others
            document.querySelectorAll(".filter-dropdown-menu").forEach(m => {
                if (m !== menu) m.classList.add("hidden");
            });

            menu.classList.toggle("hidden");
        }

        function initFilterDropdown(selectId, filterType) {
            const select = document.getElementById(selectId);
            const wrapper = document.querySelector(`.filter-dropdown[data-select="${selectId}"]`);
            if (!select || !wrapper) return;

            const labelSpan = wrapper.querySelector(".filter-dropdown-label");
            const menu = wrapper.querySelector(".filter-dropdown-menu");
            if (!menu) return;

            menu.innerHTML = "";

            Array.from(select.options).forEach(opt => {
                const btn = document.createElement("button");
                btn.type = "button";
                btn.className = "block w-full text-left px-3 py-1.5 hover:bg-gray-100 text-xs text-gray-800";
                btn.textContent = opt.textContent;
                btn.dataset.value = opt.value;

                btn.addEventListener("click", () => {
                    select.value = opt.value;
                    if (labelSpan) labelSpan.textContent = opt.textContent;
                    document.querySelectorAll(".filter-dropdown-menu").forEach(m => m.classList.add("hidden"));

                    if (filterType === "inquiries") filterAndSortInquiries();
                    else if (filterType === "reviews") filterAndSortReviews();
                    else if (filterType === "events") filterAndSortEvents();
                });

                menu.appendChild(btn);
            });

            const selected = select.options[select.selectedIndex] || select.options[0];
            if (selected && labelSpan) {
                labelSpan.textContent = selected.textContent;
            }
        }

        function initAllFilterDropdowns() {
            initFilterDropdown("inquiryStatusFilter", "inquiries");
            initFilterDropdown("inquiryIndustryFilter", "inquiries");
            initFilterDropdown("inquirySort", "inquiries");
        }

        populateIndustryFilter();
        initAllFilterDropdowns();
        filterAndSortInquiries();

        document.getElementById("inquiryKeyword")
            ?.addEventListener("input", filterAndSortInquiries);

        document.getElementById("inquiryStatusFilter")
            ?.addEventListener("change", filterAndSortInquiries);

        document.getElementById("inquiryIndustryFilter")
            ?.addEventListener("change", filterAndSortInquiries);

        document.getElementById("inquirySort")
            ?.addEventListener("change", filterAndSortInquiries);

    </script>

</body>

<footer class="mt-16 border-t bg-white text-gray-600 shadow-inner">
    <div class="max-w-7xl mx-auto px-6 py-6 flex flex-col md:flex-row justify-between items-center text-sm">
        <span>  AI-Solution. Internal Use Only.</span>
        <span>© {{ current_year }} AI-Solution. Internal Use Only.</span>
        <span class="mt-2 md:mt-0">Admin System v1.0 · <a href="#" class="underline hover:text-gray-700">Support</a></span>
        <span class="mt-2 md:mt-0">Server Time: {{ current_year }}</span>
    </div>
</footer>

</html>